; Listing generated by Microsoft (R) Optimizing Compiler Version 19.38.33134.0 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?genv@@3UGlobalExternVariables@@A		; genv
PUBLIC	?load_address@@3_KA				; load_address
_BSS	SEGMENT
?load_address@@3_KA DQ 01H DUP (?)			; load_address
_BSS	ENDS
CONST	SEGMENT
$SG93173 DB	'dump_by_stub', 00H
CONST	ENDS
A$A	SEGMENT
?genv@@3UGlobalExternVariables@@A	ORG $+12		; genv
A$A	ENDS
PUBLIC	?StubEntryPoint@@YAXXZ				; StubEntryPoint
EXTRN	__imp_CreateFileA:PROC
EXTRN	__imp_WriteFile:PROC
EXTRN	__imp_GetModuleHandleA:PROC
pdata	SEGMENT
$pdata$?StubEntryPoint@@YAXXZ DD imagerel $LN3
	DD	imagerel $LN3+120
	DD	imagerel $unwind$?StubEntryPoint@@YAXXZ
pdata	ENDS
xdata	SEGMENT
$unwind$?StubEntryPoint@@YAXXZ DD 010401H
	DD	0c204H
xdata	ENDS
; Function compile flags: /Odtp
; File D:\licenta\mypacker\stub\stub.cpp
_TEXT	SEGMENT
bytes$ = 64
hModule$ = 72
dump$ = 80
?StubEntryPoint@@YAXXZ PROC				; StubEntryPoint

; 24   : void __declspec(noinline) StubEntryPoint() {

$LN3:
  00000	48 83 ec 68	 sub	 rsp, 104		; 00000068H

; 25   :     HMODULE hModule = GetModuleHandle(NULL);

  00004	33 c9		 xor	 ecx, ecx
  00006	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_GetModuleHandleA
  0000c	48 89 44 24 48	 mov	 QWORD PTR hModule$[rsp], rax

; 26   :     
; 27   :     HANDLE dump = CreateFile("dump_by_stub", GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);

  00011	48 c7 44 24 30
	00 00 00 00	 mov	 QWORD PTR [rsp+48], 0
  0001a	c7 44 24 28 80
	00 00 00	 mov	 DWORD PTR [rsp+40], 128	; 00000080H
  00022	c7 44 24 20 02
	00 00 00	 mov	 DWORD PTR [rsp+32], 2
  0002a	45 33 c9	 xor	 r9d, r9d
  0002d	45 33 c0	 xor	 r8d, r8d
  00030	ba 00 00 00 40	 mov	 edx, 1073741824		; 40000000H
  00035	48 8d 0d 00 00
	00 00		 lea	 rcx, OFFSET FLAT:$SG93173
  0003c	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_CreateFileA
  00042	48 89 44 24 50	 mov	 QWORD PTR dump$[rsp], rax

; 28   :     long unsigned int bytes = 0;

  00047	c7 44 24 40 00
	00 00 00	 mov	 DWORD PTR bytes$[rsp], 0

; 29   :     WriteFile(dump, hModule, sizeof(HMODULE), &bytes, NULL);

  0004f	48 c7 44 24 20
	00 00 00 00	 mov	 QWORD PTR [rsp+32], 0
  00058	4c 8d 4c 24 40	 lea	 r9, QWORD PTR bytes$[rsp]
  0005d	41 b8 08 00 00
	00		 mov	 r8d, 8
  00063	48 8b 54 24 48	 mov	 rdx, QWORD PTR hModule$[rsp]
  00068	48 8b 4c 24 50	 mov	 rcx, QWORD PTR dump$[rsp]
  0006d	ff 15 00 00 00
	00		 call	 QWORD PTR __imp_WriteFile

; 30   : }

  00073	48 83 c4 68	 add	 rsp, 104		; 00000068H
  00077	c3		 ret	 0
?StubEntryPoint@@YAXXZ ENDP				; StubEntryPoint
_TEXT	ENDS
END
